<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
      main {
        flex: 1 0 auto;
      }
      .navbar-brand {
        font-weight: bold;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
      }
      .navbar-brand::before {
        content: "CU";
        background: #e50914;
        color: #fff;
        padding: 5px 10px;
        border-radius: 5px;
        margin-right: 10px;
        font-size: 1.2rem;
      }
      .navbar-brand-text {
        display: inline;
      }
      @media (max-width: 300px) {
        .navbar-brand-text {
          display: none;
        }
      }
      .card {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        backdrop-filter: blur(10px);
        color: #fff;
        transition: transform 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .btn-primary {
        background-color: #e50914;
        border-color: #e50914;
      }
      .btn-primary:hover {
        background-color: #c40812;
        border-color: #c40812;
      }
      .btn-outline-light {
        color: #fff;
        border-color: #fff;
      }
      .btn-outline-light:hover {
        background-color: #fff;
        color: #1e3c72;
      }
      .hero-section {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background: url("https://images.unsplash.com/photo-1620641788421-7a1c342ea42e")
          no-repeat center/cover;
      }
      .hero-section h1 {
        font-size: 3rem;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }
      .form-container {
        background: rgba(255, 255, 255, 0.2);
        padding: 2rem;
        border-radius: 10px;
        backdrop-filter: blur(10px);
      }
      .floating {
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      .modal-content {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        backdrop-filter: blur(10px);
        border: none;
      }
      .modal-header {
        border-bottom: none;
      }
      .btn-loading .spinner-border {
        width: 1rem;
        height: 1rem;
        margin-right: 0.5rem;
      }
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1055;
      }
      footer {
        background: #1e3c72;
        padding: 1.5rem 0;
        flex-shrink: 0;
      }
      footer .cu-logo::before {
        content: "CU";
        background: #e50914;
        color: #fff;
        padding: 3px 8px;
        border-radius: 5px;
        margin-right: 8px;
        font-size: 1rem;
      }
      footer a {
        color: #fff;
        text-decoration: none;
      }
      footer a:hover {
        text-decoration: underline;
      }
      .search-container {
        max-width: 500px;
        margin: 0 auto 2rem;
      }
      .avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        margin-right: 0.5rem;
      }
      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-left: 1rem;
      }
      .category-badge {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav
      id="navbar"
      class="navbar navbar-expand-lg navbar-dark bg-dark d-none"
    >
      <div class="container">
        <a class="navbar-brand" href="#"><span class="navbar-brand-text">ComradeUpdates</span></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="#" onclick="logout()">Logout</a>
            </li>
            <li>
              <img
                id="user-avatar"
                class="user-avatar d-none"
                alt="User Avatar"
              />
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main>
      <!-- Landing Page -->
      <div id="landing-page" class="hero-section">
        <div>
          <h1 class="mb-4 floating">Welcome to ComradeUpdates</h1>
          <p class="lead mb-4">
            Stay ahead with the latest Web3 updates and opportunities!
          </p>
          <div class="d-flex justify-content-center gap-3">
            <button class="btn btn-primary btn-lg" onclick="showAuth()">
              Get Started
            </button>
            <button
              class="btn btn-outline-light btn-lg"
              data-bs-toggle="modal"
              data-bs-target="#howItWorksModal"
            >
              How It Works
            </button>
          </div>
        </div>
      </div>

      <!-- How It Works Modal -->
      <div
        class="modal fade"
        id="howItWorksModal"
        tabindex="-1"
        aria-labelledby="howItWorksModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="howItWorksModalLabel">How ComradeUpdates Works</h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <h6>Welcome to ComradeUpdates!</h6>
              <p>
                ComradeUpdates is your go-to platform for staying informed about the latest Web3 opportunities, including crypto projects, tasks, surveys, and more.
              </p>
              <h6>How It Works</h6>
              <ul>
                <li><strong>Sign Up or Log In:</strong> Create an account to access exclusive Web3 updates or log in if you're already a member.</li>
                <li><strong>Explore Updates:</strong> Browse posts categorized as Crypto, Tasks, Surveys, and more, curated by our admin team.</li>
                <li><strong>Engage:</strong> Like, comment, and share posts to connect with the community and stay updated on trending opportunities.</li>
                <li><strong>Contribute (Admins):</strong> If you're an admin, post new updates to keep the community informed about the latest Web3 developments.</li>
              </ul>
              <h6>Why Use ComradeUpdates?</h6>
              <ul>
                <li><strong>Stay Ahead:</strong> Get real-time updates on Web3 trends and opportunities.</li>
                <li><strong>Community-Driven:</strong> Interact with like-minded individuals passionate about Web3.</li>
                <li><strong>Easy to Use:</strong> A user-friendly interface makes navigation a breeze.</li>
              </ul>
              <p>
                Join ComradeUpdates today and unlock a world of Web3 possibilities!
              </p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="showAuth()">
                Get Started
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Auth Section -->
      <div id="auth-section" class="container my-5 d-none">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="form-container">
              <h2 id="auth-title" class="text-center mb-4">Sign Up</h2>
              <form id="auth-form">
                <div id="signup-fields">
                  <div class="mb-3">
                    <label for="name" class="form-label">Full Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      name="name"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="signup-email" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="signup-email"
                      name="email"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="signup-password" class="form-label"
                      >Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="signup-password"
                      name="password"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="confirm-password" class="form-label"
                      >Confirm Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="confirm-password"
                      name="confirm-password"
                      required
                    />
                  </div>
                </div>
                <div id="login-fields" class="d-none">
                  <div class="mb-3">
                    <label for="login-email" class="form-label">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="login-email"
                      name="email"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="login-password" class="form-label"
                      >Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="login-password"
                      name="password"
                      required
                    />
                  </div>
                </div>
                <button
                  type="submit"
                  class="btn btn-primary w-100"
                  id="auth-btn"
                >
                  <span
                    class="spinner-border spinner-border-sm d-none"
                    role="status"
                    aria-hidden="true"
                  ></span>
                  Sign Up
                </button>
                <p class="text-center mt-3">
                  <a href="#" onclick="toggleAuthMode()"
                    >Switch to <span id="auth-switch">Login</span></a
                  >
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- CAPTCHA Section -->
      <div id="captcha-section" class="container my-5 d-none">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="form-container">
              <h2 class="text-center mb-4">Verify You're Human</h2>
              <p class="text-center mb-4">
                Solve this: <span id="captcha-question"></span>
              </p>
              <form id="captcha-form">
                <div class="mb-3">
                  <label for="captcha-answer" class="form-label">Answer</label>
                  <input
                    type="number"
                    class="form-control"
                    id="captcha-answer"
                    name="captcha-answer"
                    required
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary w-100"
                  id="captcha-btn"
                >
                  <span
                    class="spinner-border spinner-border-sm d-none"
                    role="status"
                    aria-hidden="true"
                  ></span>
                  Submit
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Dashboard -->
      <div id="admin-dashboard" class="container my-5 d-none">
        <h2 class="text-center mb-4">Admin Dashboard</h2>
        <div class="search-container">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="admin-search"
              placeholder="Search posts by title, description, or category"
            />
            <button class="btn btn-outline-light" onclick="clearSearch('admin')">
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>
        <div class="card p-4 mb-4">
          <h3>Add New Web3 Update</h3>
          <form id="post-form">
            <div class="mb-3">
              <label for="post-title" class="form-label">Title</label>
              <input
                type="text"
                class="form-control"
                id="post-title"
                name="title"
                required
              />
            </div>
            <div class="mb-3">
              <label for="post-desc" class="form-label">Description</label>
              <textarea
                class="form-control"
                id="post-desc"
                name="description"
                rows="4"
                required
              ></textarea>
            </div>
            <div class="mb-3">
              <label for="post-link" class="form-label">Link</label>
              <input
                type="url"
                class="form-control"
                id="post-link"
                name="link"
                required
              />
            </div>
            <div class="mb-3">
              <label for="post-image" class="form-label">Image URL</label>
              <input
                type="url"
                class="form-control"
                id="post-image"
                name="image"
                required
              />
            </div>
            <div class="mb-3">
              <label for="post-category" class="form-label">Category</label>
              <select
                class="form-control"
                id="post-category"
                name="category"
                required
              >
                <option value="" disabled selected>Select a category</option>
                <option value="Crypto">Crypto</option>
                <option value="Task">Task</option>
                <option value="Survey">Survey</option>
                <option value="NFT">NFT</option>
                <option value="DeFi">DeFi</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">
              <span
                class="spinner-border spinner-border-sm d-none"
                role="status"
                aria-hidden="true"
              ></span>
              Post Update
            </button>
          </form>
        </div>
        <h3>All Updates</h3>
        <div id="admin-posts" class="row"></div>
      </div>

      <!-- User Dashboard -->
      <div id="user-dashboard" class="container my-5 d-none">
        <h2 class="text-center mb-4">Web3 Updates</h2>
        <div class="search-container">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="user-search"
              placeholder="Search posts by title, description, or category"
            />
            <button class="btn btn-outline-light" onclick="clearSearch('user')">
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>
        <div id="user-posts" class="row"></div>
      </div>

      <!-- Comment Modal -->
      <div
        class="modal fade"
        id="commentModal"
        tabindex="-1"
        aria-labelledby="commentModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="commentModalLabel">Comments</h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div id="modal-comments" class="mb-3"></div>
              <form id="comment-form">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="comment-input"
                    name="comment"
                    placeholder="Add a comment"
                    required
                  />
                  <button type="submit" class="btn btn-primary">
                    <span
                      class="spinner-border spinner-border-sm d-none"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    Post
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Toast Container -->
      <div class="toast-container">
        <div
          id="appToast"
          class="toast align-items-center text-white bg-success border-0"
          role="alert"
          aria-live="assertive"
          aria-atomic="true"
        >
          <div class="d-flex">
            <div class="toast-body" id="toast-message"></div>
            <button
              type="button"
              class="btn-close btn-close-white me-2 m-auto"
              data-bs-dismiss="toast"
              aria-label="Close"
            ></button>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="text-center">
      <div class="container">
        <p class="mb-2"><span class="cu-logo"></span> ComradeUpdates</p>
        <p class="mb-2">
          <a href="#" class="mx-2">About</a>
          <a href="#" class="mx-2">Contact</a>
          <a href="#" class="mx-2">Privacy Policy</a>
        </p>
        <p>© 2025 ComradeUpdates. All rights reserved.</p>
      </div>
    </footer>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // MockAPI endpoints
      const API_USERS = "https://6852ac200594059b23ce9d1f.mockapi.io/users";
      const API_POSTS = "https://6852ac200594059b23ce9d1f.mockapi.io/posts";
      const WHATSAPP_LINK = "https://wa.me/2348124080834"; // Replace with your WhatsApp link

      let currentUser = null;
      let isLoginMode = false;
      let currentPostId = null;
      let allPosts = [];
      let captchaData = {};
      let signupEmail = "";
      const commentModal = new bootstrap.Modal(
        document.getElementById("commentModal")
      );
      const toastElement = document.getElementById("appToast");
      const toast = new bootstrap.Toast(toastElement);

      // Show toast notification
      function showToast(message) {
        document.getElementById("toast-message").textContent = message;
        toast.show();
      }

      // Toggle button loading state
      function toggleButtonLoading(button, isLoading) {
        const spinner = button.querySelector(".spinner-border");
        if (isLoading) {
          button.disabled = true;
          spinner.classList.remove("d-none");
        } else {
          button.disabled = false;
          spinner.classList.add("d-none");
        }
      }

      // Generate CAPTCHA
      function generateCaptcha() {
        const a = Math.floor(Math.random() * 10) + 1;
        const b = Math.floor(Math.random() * 10) + 1;
        captchaData = { question: `${a} + ${b}`, answer: a + b };
        document.getElementById("captcha-question").textContent =
          captchaData.question;
      }

      // Show auth section
      function showAuth() {
        document.getElementById("landing-page").classList.add("d-none");
        document.getElementById("auth-section").classList.remove("d-none");
        document.getElementById("navbar").classList.add("d-none");
      }

      // Toggle between signup and login
      function toggleAuthMode(isCaptchaSuccess = false) {
        isLoginMode = !isLoginMode || isCaptchaSuccess;
        document.getElementById("auth-title").textContent = isLoginMode
          ? "Login"
          : "Sign Up";
        document.getElementById("auth-btn").innerHTML = isLoginMode
          ? '<span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span> Login'
          : '<span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span> Sign Up';
        document.getElementById("auth-switch").textContent = isLoginMode
          ? "Sign Up"
          : "Login";
        document.getElementById("signup-fields").classList.toggle("d-none", isLoginMode);
        document.getElementById("login-fields").classList.toggle("d-none", !isLoginMode);
        // Disable hidden inputs to prevent validation errors
        document.getElementById("signup-email").disabled = isLoginMode;
        document.getElementById("signup-password").disabled = isLoginMode;
        document.getElementById("confirm-password").disabled = isLoginMode;
        document.getElementById("name").disabled = isLoginMode;
        document.getElementById("login-email").disabled = !isLoginMode;
        document.getElementById("login-password").disabled = !isLoginMode;
        if (isCaptchaSuccess) {
          document.getElementById("login-email").value = signupEmail;
        }
      }

      // Handle auth form submission
      document
        .getElementById("auth-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const button = document.getElementById("auth-btn");
          toggleButtonLoading(button, true);
          let email, password;
          if (isLoginMode) {
            email = document.getElementById("login-email").value;
            password = document.getElementById("login-password").value;
          } else {
            email = document.getElementById("signup-email").value;
            password = document.getElementById("signup-password").value;
          }

          try {
            if (isLoginMode) {
              // Login: Fetch all users and filter client-side
              const response = await fetch(API_USERS);
              const users = await response.json();
              const user = users.find(
                (u) => u.email === email && u.password === password
              );
              if (user) {
                currentUser = user;
                showDashboard();
                showToast(`Welcome back, ${user.name}!`);
                document.getElementById("user-avatar").src = `https://ui-avatars.com/api/?name=${encodeURIComponent(
                  user.name
                )}&background=random`;
                document.getElementById("user-avatar").classList.remove("d-none");
              } else {
                alert("Invalid email or password");
              }
            } else {
              // Signup
              const name = document.getElementById("name").value;
              const confirmPassword =
                document.getElementById("confirm-password").value;
              if (password !== confirmPassword) {
                alert("Passwords do not match");
                toggleButtonLoading(button, false);
                return;
              }
              const role =
                email === "ridwansaliu84@gmail.com" ? "admin" : "user";
              const response = await fetch(API_USERS, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password, role, name }),
              });
              if (response.ok) {
                signupEmail = email;
                document.getElementById("auth-form").reset();
                document.getElementById("auth-section").classList.add("d-none");
                document
                  .getElementById("captcha-section")
                  .classList.remove("d-none");
                generateCaptcha();
              } else {
                alert("Signup failed");
              }
            }
          } catch (error) {
            alert("An error occurred. Please try again.");
          } finally {
            toggleButtonLoading(button, false);
          }
        });

      // Handle CAPTCHA submission
      document
        .getElementById("captcha-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const button = document.getElementById("captcha-btn");
          toggleButtonLoading(button, true);
          const answer = parseInt(
            document.getElementById("captcha-answer").value
          );
          if (answer === captchaData.answer) {
            document.getElementById("captcha-section").classList.add("d-none");
            document.getElementById("auth-section").classList.remove("d-none");
            toggleAuthMode(true);
          } else {
            alert("Incorrect answer. Try again.");
            generateCaptcha();
            document.getElementById("captcha-form").reset();
          }
          toggleButtonLoading(button, false);
        });

      // Show appropriate dashboard
      function showDashboard() {
        document.getElementById("auth-section").classList.add("d-none");
        document.getElementById("navbar").classList.remove("d-none");
        if (currentUser.role === "admin") {
          document.getElementById("admin-dashboard").classList.remove("d-none");
          loadPosts("admin");
        } else {
          document.getElementById("user-dashboard").classList.remove("d-none");
          loadPosts("user");
        }
      }

      // Handle post submission
      document
        .getElementById("post-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const button = e.target.querySelector("button");
          toggleButtonLoading(button, true);
          const post = {
            title: document.getElementById("post-title").value,
            description: document.getElementById("post-desc").value,
            link: document.getElementById("post-link").value,
            image: document.getElementById("post-image").value,
            category: document.getElementById("post-category").value,
            likes: 0,
            comments: [],
          };
          try {
            const response = await fetch(API_POSTS, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(post),
            });
            if (response.ok) {
              document.getElementById("post-form").reset();
              loadPosts("admin");
              showToast("Update posted successfully!");
            } else {
              alert("Failed to post update");
            }
          } catch (error) {
            alert("An error occurred. Please try again.");
          } finally {
            toggleButtonLoading(button, false);
          }
        });

      // Load posts for admin or user
      async function loadPosts(type) {
        try {
          const response = await fetch(API_POSTS);
          allPosts = await response.json();
          renderPosts(type, allPosts);
        } catch (error) {
          alert("Failed to load posts");
        }
      }

      // Render posts with optional filtering
      function renderPosts(type, posts) {
        const container = document.getElementById(`${type}-posts`);
        container.innerHTML = "";
        if (posts.length === 0) {
          container.innerHTML = '<p class="text-center">No results found.</p>';
          return;
        }
        posts.forEach((post) => {
          const card = `
            <div class="col-md-4 mb-4">
              <div class="card">
                <img src="${post.image}" class="card-img-top" alt="Web3 Update" style="height: 200px; object-fit: cover;">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="card-title mb-0">${post.title}</h5>
                    <span class="badge bg-primary category-badge">${post.category || 'Other'}</span>
                  </div>
                  <p class="card-text">${post.description}</p>
                  <div class="d-flex gap-2 mb-2">
                    <a href="${post.link}" target="_blank" class="btn btn-primary btn-sm flex-fill">Visit Link</a>
                    <a href="${WHATSAPP_LINK}" target="_blank" class="btn btn-outline-light btn-sm flex-fill">Message Admin</a>
                  </div>
                  ${
                    type === "user"
                      ? `
                    <div class="d-flex justify-content-between align-items-center">
                      <button class="btn btn-outline-light btn-sm" onclick="likePost('${
                        post.id
                      }', this)">
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        <i class="bi bi-heart-fill"></i> ${post.likes}
                      </button>
                      <button class="btn btn-outline-light btn-sm" onclick="showComments('${
                        post.id
                      }')">
                        <i class="bi bi-chat"></i> ${post.comments.length}
                      </button>
                      <button class="btn btn-outline-light btn-sm" onclick="sharePost('${
                        post.id
                      }', this)">
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        <i class="bi bi-share"></i>
                      </button>
                    </div>
                  `
                      : ""
                  }
                </div>
              </div>
            </div>
          `;
          container.innerHTML += card;
        });
      }

      // Search posts
      function searchPosts(type) {
        const searchInput = document
          .getElementById(`${type}-search`)
          .value.toLowerCase();
        const filteredPosts = allPosts.filter(
          (post) =>
            post.title.toLowerCase().includes(searchInput) ||
            post.description.toLowerCase().includes(searchInput) ||
            (post.category || "").toLowerCase().includes(searchInput)
        );
        renderPosts(type, filteredPosts);
      }

      // Clear search
      function clearSearch(type) {
        document.getElementById(`${type}-search`).value = "";
        renderPosts(type, allPosts);
      }

      // Add search event listeners
      document
        .getElementById("admin-search")
        ?.addEventListener("input", () => searchPosts("admin"));
      document
        .getElementById("user-search")
        ?.addEventListener("input", () => searchPosts("user"));

      // Like post
      async function likePost(postId, button) {
        toggleButtonLoading(button, true);
        try {
          const response = await fetch(`${API_POSTS}/${postId}`);
          const post = await response.json();
          post.likes += 1;
          const updateResponse = await fetch(`${API_POSTS}/${postId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(post),
          });
          if (updateResponse.ok) {
            loadPosts(currentUser.role);
            showToast("Post liked!");
          } else {
            alert("Failed to like post");
          }
        } catch (error) {
          alert("An error occurred. Please try again.");
        } finally {
          toggleButtonLoading(button, false);
        }
      }

      // Fetch user by email
      async function getUserByEmail(email) {
        try {
          const response = await fetch(API_USERS);
          const users = await response.json();
          return users.find((u) => u.email === email) || { name: "Unknown User" };
        } catch (error) {
          return { name: "Unknown User" };
        }
      }

      // Show comments in modal
      async function showComments(postId) {
        currentPostId = postId;
        try {
          const response = await fetch(`${API_POSTS}/${postId}`);
          const post = await response.json();
          const commentsContainer = document.getElementById("modal-comments");
          commentsContainer.innerHTML = "";
          if (post.comments.length === 0) {
            commentsContainer.innerHTML =
              '<p class="mb-0"><small>No comments yet.</small></p>';
          } else {
            for (const comment of post.comments) {
              const user = await getUserByEmail(comment.email);
              commentsContainer.innerHTML += `
                <div class="d-flex align-items-start mb-2">
                  <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(
                    user.name
                  )}&background=random" class="avatar" alt="${user.name}">
                  <div>
                    <strong>${user.name}</strong>
                    <p class="mb-0"><small>${comment.text}</small></p>
                  </div>
                </div>
                <hr class="my-2">
              `;
            }
          }
          commentModal.show();
        } catch (error) {
          alert("Failed to load comments");
        }
      }

      // Add comment
      document
        .getElementById("comment-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const button = e.target.querySelector("button");
          toggleButtonLoading(button, true);
          const commentText = document.getElementById("comment-input").value;
          try {
            const response = await fetch(`${API_POSTS}/${currentPostId}`);
            const post = await response.json();
            post.comments.push({ email: currentUser.email, text: commentText });
            const updateResponse = await fetch(`${API_POSTS}/${currentPostId}`, {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(post),
            });
            if (updateResponse.ok) {
              document.getElementById("comment-form").reset();
              showComments(currentPostId);
              loadPosts(currentUser.role);
              showToast("Comment added!");
            } else {
              alert("Failed to add comment");
            }
          } catch (error) {
            alert("An error occurred. Please try again.");
          } finally {
            toggleButtonLoading(button, false);
          }
        });

      // Share post
      async function sharePost(postId, button) {
        toggleButtonLoading(button, true);
        try {
          const response = await fetch(`${API_POSTS}/${postId}`);
          const post = await response.json();
          const shareUrl = `${window.location.origin}/post/${postId}`;
          const shareText = `Check out this Web3 update: ${post.title} on ComradeUpdates! ${shareUrl}`;
          if (navigator.share && navigator.canShare({ url: shareUrl })) {
            await navigator.share({
              title: post.title,
              text: post.description,
              url: shareUrl,
            });
            showToast("Post shared successfully!");
          } else {
            await navigator.clipboard.writeText(shareText);
            showToast("Link copied to clipboard!");
          }
        } catch (error) {
          alert("Failed to share post");
        } finally {
          toggleButtonLoading(button, false);
        }
      }

      // Logout
      function logout() {
        currentUser = null;
        document.getElementById("admin-dashboard").classList.add("d-none");
        document.getElementById("user-dashboard").classList.add("d-none");
        document.getElementById("auth-section").classList.add("d-none");
        document.getElementById("captcha-section").classList.add("d-none");
        document.getElementById("landing-page").classList.remove("d-none");
        document.getElementById("navbar").classList.add("d-none");
        document.getElementById("user-avatar").classList.add("d-none");
        showToast("Logged out successfully!");
      }
    </script>
  </body>
</html>